
## 系统介绍

创建一个与交易管理相关的简单应用程序。该应用程序将列出所有现有事件，用户可以添加、删除和修改事件。

## 设计方案

## **架构风格**

- **RESTful API**: 使用 RESTful 风格设计 API，提供标准化的接口以便于客户端交互。
- **分层架构**: 划分为表示层、业务逻辑层和数据访问层，以实现良好的解耦和可维护性。

**技术栈**:

- **后端**: Java 21,  Spring Boot，mybatis-plus
- **构建工具**: Maven
- **容器化**: Docker

**数据设计**：

- 数据库：使用轻量级H2 数据库，可以在内存模式下运行

- 表: transaction
- 数据库维护: flyway

**API 设计**：

1. **接口设计**:

  - GET /api/transactions

    交易分页列表：

    - 支持参数: 分页（`page` 和 `size`）、模糊查询（`title`）
    - 返回: 事件分页列表

  - GET /api/transactions/{id}

    交易详情：

    - 支持参数: 交易 ID
    - 返回: 事件详情

  - POST /api/transactions

    创建交易：

    - 请求体: `transaction` 对象
    - 返回: 创建的事件

   - PUT /api/transactions/{id}

     交易事件：

     - 参数: 事件 ID
     - 请求体: 更新的 `transaction` 对象
     - 返回: 更新后的事件

  - DELETE /api/transactions/{id}

    交易事件：

    - 参数: 事件 ID
    - 返回: 操作结果状态

  2.**验证和异常处理**:

- 集成spring-boot-starter-validation进行参数校验，并在统一异常处理中解析校验错误信息返回。
- 统一的异常处理机制，自定义异常、封装统一返回结果，返回标准化格式的错误响应。

 **缓存机制**：

- 使用Spring Cache， 使用 `@Cacheable`, `@CachePut`, `@CacheEvict` 和 `@Caching` 注解来管理缓存。

- 配置了 Caffeine 作为本地缓存

- - Guava的布隆过滤器用于防穿透

  - 用排它锁循环重试的方式防击穿

  - 用随机过期时间的方式防雪崩

- 缓存一致性问题：

  - 延时双删 + cache aside

##  **测试**

  1、单元测试：
      JUnit 和 Mockito

  2、压力测试计划(未执行)：

### 1. 测试目标

评估系统在CRUD（创建、读取、更新、删除）操作和分页功能下的性能表现，确保系统在高并发和大数据量情况下仍能稳定运行。

### 2. 测试范围

- **CRUD操作**：测试创建、读取、更新、删除操作的响应时间和吞吐量。
- **分页功能**：测试不同分页大小下的响应时间和吞吐量。

### 3. 测试环境

- **硬件环境**：CPU、内存、磁盘、网络等配置。
- **软件环境**：操作系统、数据库、应用服务器、中间件等版本信息。
- **测试工具**：JMeter、LoadRunner、Gatling等。

### 4. 测试场景

- **单用户场景**：单个用户执行CRUD操作和分页查询，评估系统在低负载下的性能。
- **多用户并发场景**：模拟多个用户同时执行CRUD操作和分页查询，评估系统在高并发下的性能。
- **大数据量场景**：在数据库中预先生成大量数据，测试分页查询的性能。

### 5. 测试指标

- **响应时间**：从发送请求到接收到响应的时间。
- **吞吐量**：单位时间内系统处理的请求数量。
- **错误率**：请求失败的比例。
- **资源利用率**：CPU、内存、磁盘I/O、网络带宽等资源的使用情况。

### 6. 测试步骤

1. #### **准备测试数据**：

   - 确保测试数据的多样性和代表性。

2. #### **配置测试工具**：

   - 设置并发用户数、循环次数、思考时间等参数。
   - 配置测试脚本，模拟CRUD操作和分页查询。

3. #### **执行测试**：

   - 高频率混合插入包含重复和不重复
   - 高频率更新,包含不存在的id
   - 高频率单条查询包括重复
   - 高频率分页
   - 深分页
   - 混合操作
   - 长时间压力测试

4. #### **监控系统资源**：

   - 使用监控工具（如Prometheus、Grafana）实时监控系统的CPU、内存、磁盘I/O、网络带宽等资源使用情况。

5. #### **收集和分析测试结果**：

   - 收集响应时间、吞吐量、错误率等数据。
   - 分析系统在不同场景下的性能表现，找出性能瓶颈。

6. #### **生成测试报告**：

   - 汇总测试结果，生成详细的性能测试报告。
   - 报告中应包括测试环境、测试场景、测试指标、测试结果、性能瓶颈分析等内容。

##   部署方案

  - Docker: 配置 Dockerfile 构建镜像。

##  **第三方包**

1. **`spring-boot-starter-web`**
   - **用途**：springmvc和内置tomcat
2. **`spring-boot-starter-validation`**
   - **用途**：数据验证用的
3. **`spring-boot-devtools`**
   - **用途**：热部署, 提升效率
4. **`spring-boot-starter-cache`**
   - **用途**：缓存支持
5. **`caffeine`**
   - **用途**：缓存实现
6. **`guava`**
   - **用途**：工具包, 这里用到了它的布隆过滤器
7. **`spring-boot-starter-aop`**
   - **用途**：aop
8. **`spring-boot-starter-test`**
   - **用途**：单元测试用
9. **`h2`**
   - **用途**：支持内存模式的数据库
10. **`lombok`**
    - **用途**：简化代码编写
11. **`commons-lang3`**
    - **用途**：工具类包
12. **`commons-collections4`**
    - **用途**：集合类扩展包
13. **`junit`**
    - **用途**：单元测试用
14. **`mybatis-plus-boot-starter`**
    - **用途**：MyBatis-Plus 是 MyBatis 的增强工具，提供了更便捷的 CRUD 操作、分页、代码生成等功能。
15. **`flyway-core`**
    - **用途**：因为用的是数据库内存模式, 需要每次启动的时候初始化表结构